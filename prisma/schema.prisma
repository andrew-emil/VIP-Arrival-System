datasource db {
    provider = "postgresql"
}

generator client {
    provider = "prisma-client-js"
}

enum MatchType {
    exact
    none
}

enum CameraSource {
    webhook
    manual
}

enum AuditEventType {
    received
    normalized
    matched
}

model PlateRead {
    id String @id @default(uuid())

    // Plate data
    plateRaw        String //required
    plateNormalized String //required

    // Timestamps
    readAt     DateTime?
    receivedAt DateTime  @default(now())

    // Camera info
    cameraId    String
    confidence  Float?
    snapshotUrl String?
    source      CameraSource

    // Matching result
    isVip     Boolean
    matchType MatchType
    vipId     String?

    // Payload & logs
    rawPayload Json

    // Relations
    vip    Vip?    @relation(fields: [vipId], references: [id])
    camera Camera? @relation(fields: [cameraId], references: [id])

    auditLogs AuditLog[]

    @@index([plateNormalized])
    @@index([cameraId])
    @@index([receivedAt])
}

model Vip {
    id              String  @id @default(uuid())
    plateNormalized String  @unique
    name            String
    active          Boolean @default(true)

    plateReads PlateRead[]
}

model Camera {
    id       String  @id @default(uuid())
    name     String?
    location String?

    plateReads PlateRead[]
}

model AuditLog {
    id       String  @id @default(uuid())

    plateReadId String
    plateRead   PlateRead @relation(fields: [plateReadId], references: [id])

    eventType AuditEventType
    meta      Json?

    createdAt DateTime @default(now())
}